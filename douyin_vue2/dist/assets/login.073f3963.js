import{i as c,a as d}from"./request.b4f983bf.js";import{u}from"./token.c8436611.js";import{n as p}from"./index.d6cacc81.js";const g=t=>{const e=new URLSearchParams;for(let o in t)e.append(o,t[o]);return c.post("/user/register",e)},v=t=>{const e=new URLSearchParams;for(let o in t)e.append(o,t[o]);return c.post("/user/doLogin",e)},m=()=>c.get("/user/isLogin"),f=t=>c.put("/user/getVerificationCode",t);const h={name:"Login",data(){return{loginpojo:{username:"",password:"",confirmPassword:""},verificationCode:"",emailPattern:"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,}$",isPasswordLogin:!1,isAgreed:!1,isRegistering:!1,countryCodes:[],selectedCode:"+86",countdown:0,isCodeSent:!1}},mounted(){d.get("src/assets/json/phone.json").then(t=>{this.countryCodes=t.data}).catch(t=>{console.error("Error loading country codes:",t)})},methods:{validateEmail(){/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(this.loginpojo.username)||alert("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u90AE\u7BB1\u5730\u5740")},closeScreen(){this.$router.go(-1),console.log("\u5173\u95ED\u754C\u9762")},clearPhoneNumber(){this.loginpojo.username="",this.loginpojo.password="",this.loginpojo.confirmPassword=""},async getVerificationCode(){if(!this.loginpojo.username){alert("\u8BF7\u8F93\u5165\u90AE\u7BB1");return}try{if((await f(this.loginpojo.username)).data.code===1){alert("\u83B7\u53D6\u9A8C\u8BC1\u7801\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");return}this.isCodeSent=!0,this.countdown=60;const e=setInterval(()=>{this.countdown===0?(clearInterval(e),this.isCodeSent=!1):this.countdown--},1e3)}catch(t){console.error("\u83B7\u53D6\u9A8C\u8BC1\u7801\u5931\u8D25\uFF1A",t)}},async verifyPhoneNumber(){if(!this.isAgreed){alert("\u8BF7\u52FE\u9009\u7528\u6237\u534F\u8BAE\u4EE5\u7EE7\u7EED\u767B\u5F55\u3002");return}if(!this.verificationCode){alert("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801");return}console.log("\u9A8C\u8BC1\u624B\u673A\u53F7:",this.loginpojo);try{const t=await v({...this.loginpojo,verificationCode:this.verificationCode});if(t.data.code===1)console.error("\u767B\u5F55\u5931\u8D25\uFF1A",error);else{const e=t.data.data;u().setToken(e),localStorage.setItem("token",e),this.$router.push("/")}}catch(t){console.error("\u767B\u5F55\u5931\u8D25\uFF1A",t)}},switchToPasswordLogin(){this.isPasswordLogin=!0},switchToRegister(){this.isRegistering=!0},switchToLogin(){this.isRegistering=!1},async register(){if(!this.isAgreed){alert("\u8BF7\u52FE\u9009\u7528\u6237\u534F\u8BAE\u4EE5\u7EE7\u7EED\u6CE8\u518C\u3002");return}if(this.loginpojo.password!==this.loginpojo.confirmPassword){alert("\u5BC6\u7801\u548C\u786E\u8BA4\u5BC6\u7801\u4E0D\u5339\u914D");return}if(!this.verificationCode){alert("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801");return}console.log("\u6CE8\u518C\u624B\u673A\u53F7:",this.loginpojo);try{(await g({...this.loginpojo,verificationCode:this.verificationCode})).data.code===1?alert("\u6CE8\u518C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"):this.verifyPhoneNumber()}catch(t){console.error("\u6CE8\u518C\u5931\u8D25\uFF1A",t)}},async getinfo(){(await m()).data}}};var _=function(){var e=this,o=e._self._c;return o("div",{staticClass:"login-screen"},[o("div",{staticClass:"header"},[o("button",{staticClass:"close-btn",on:{click:e.closeScreen}},[e._v("\xD7")]),e._m(0)]),o("div",{staticClass:"content"},[o("p",{staticClass:"notice"},[e._v("\u767B\u5F55\u540E\u5373\u53EF\u70B9\u8D5E\u559C\u6B22\u7684\u5185\u5BB9")]),e.isRegistering?e._e():o("div",{staticClass:"login-form"},[o("div",{staticClass:"input-group"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.loginpojo.username,expression:"loginpojo.username"}],attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF08\u6682\u652F\u6301\u90AE\u7BB1\uFF09"},domProps:{value:e.loginpojo.username},on:{blur:e.validateEmail,input:function(s){s.target.composing||e.$set(e.loginpojo,"username",s.target.value)}}}),o("input",{directives:[{name:"model",rawName:"v-model",value:e.loginpojo.password,expression:"loginpojo.password"}],attrs:{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},domProps:{value:e.loginpojo.password},on:{input:function(s){s.target.composing||e.$set(e.loginpojo,"password",s.target.value)}}})]),o("div",{staticClass:"input-group"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.verificationCode,expression:"verificationCode"}],attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},domProps:{value:e.verificationCode},on:{input:function(s){s.target.composing||(e.verificationCode=s.target.value)}}}),o("button",{staticClass:"get-code-btn",attrs:{disabled:e.isCodeSent},on:{click:e.getVerificationCode}},[e._v(" "+e._s(e.countdown>0?e.countdown+"\u79D2":"\u83B7\u53D6\u9A8C\u8BC1\u7801")+" ")])]),o("p",{staticClass:"terms"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.isAgreed,expression:"isAgreed"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.isAgreed)?e._i(e.isAgreed,null)>-1:e.isAgreed},on:{change:function(s){var i=e.isAgreed,n=s.target,l=!!n.checked;if(Array.isArray(i)){var a=null,r=e._i(i,a);n.checked?r<0&&(e.isAgreed=i.concat([a])):r>-1&&(e.isAgreed=i.slice(0,r).concat(i.slice(r+1)))}else e.isAgreed=l}}}),e._v(" \u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),o("a",{attrs:{href:"#"}},[e._v("\u7528\u6237\u534F\u8BAE")]),e._v(" \u548C "),o("a",{attrs:{href:"#"}},[e._v("\u9690\u79C1\u653F\u7B56")]),e._v(" \u4EE5\u53CA "),o("a",{attrs:{href:"#"}},[e._v("\u8FD0\u8425\u5546\u670D\u52A1\u534F\u8BAE")]),e._v(" \uFF0C\u8FD0\u8425\u5546\u5C06\u5BF9\u4F60\u7684\u624B\u673A\u53F7\u8FDB\u884C\u9A8C\u8BC1 ")]),o("button",{staticClass:"login-btn",on:{click:e.verifyPhoneNumber}},[e._v("\u9A8C\u8BC1\u5E76\u767B\u5F55")]),o("div",{staticClass:"login-options"},[o("button",{on:{click:e.switchToPasswordLogin}},[e._v("\u5BC6\u7801\u767B\u5F55")]),o("button",{on:{click:e.switchToRegister}},[e._v("\u5207\u6362\u5230\u6CE8\u518C")])])]),e.isRegistering?o("div",{staticClass:"login-form"},[o("div",{staticClass:"input-group"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.loginpojo.username,expression:"loginpojo.username"}],attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF08\u6682\u652F\u6301\u90AE\u7BB1\uFF09"},domProps:{value:e.loginpojo.username},on:{blur:e.validateEmail,input:function(s){s.target.composing||e.$set(e.loginpojo,"username",s.target.value)}}}),o("input",{directives:[{name:"model",rawName:"v-model",value:e.loginpojo.password,expression:"loginpojo.password"}],attrs:{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},domProps:{value:e.loginpojo.password},on:{input:function(s){s.target.composing||e.$set(e.loginpojo,"password",s.target.value)}}}),o("input",{directives:[{name:"model",rawName:"v-model",value:e.loginpojo.confirmPassword,expression:"loginpojo.confirmPassword"}],attrs:{type:"password",placeholder:"\u786E\u8BA4\u5BC6\u7801"},domProps:{value:e.loginpojo.confirmPassword},on:{input:function(s){s.target.composing||e.$set(e.loginpojo,"confirmPassword",s.target.value)}}})]),o("div",{staticClass:"input-group"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.verificationCode,expression:"verificationCode"}],attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},domProps:{value:e.verificationCode},on:{input:function(s){s.target.composing||(e.verificationCode=s.target.value)}}}),o("button",{staticClass:"get-code-btn",attrs:{disabled:e.isCodeSent},on:{click:e.getVerificationCode}},[e._v(" "+e._s(e.countdown>0?e.countdown+"\u79D2":"\u83B7\u53D6\u9A8C\u8BC1\u7801")+" ")])]),o("p",{staticClass:"terms"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.isAgreed,expression:"isAgreed"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.isAgreed)?e._i(e.isAgreed,null)>-1:e.isAgreed},on:{change:function(s){var i=e.isAgreed,n=s.target,l=!!n.checked;if(Array.isArray(i)){var a=null,r=e._i(i,a);n.checked?r<0&&(e.isAgreed=i.concat([a])):r>-1&&(e.isAgreed=i.slice(0,r).concat(i.slice(r+1)))}else e.isAgreed=l}}}),e._v(" \u5DF2\u9605\u8BFB\u5E76\u540C\u610F "),o("a",{attrs:{href:"#"}},[e._v("\u7528\u6237\u534F\u8BAE")]),e._v(" \u548C "),o("a",{attrs:{href:"#"}},[e._v("\u9690\u79C1\u653F\u7B56")]),e._v(" \u4EE5\u53CA "),o("a",{attrs:{href:"#"}},[e._v("\u8FD0\u8425\u5546\u670D\u52A1\u534F\u8BAE")]),e._v(" \uFF0C\u8FD0\u8425\u5546\u5C06\u5BF9\u4F60\u7684\u624B\u673A\u53F7\u8FDB\u884C\u9A8C\u8BC1 ")]),o("button",{staticClass:"login-btn",on:{click:e.register}},[e._v("\u6CE8\u518C\u5E76\u767B\u5F55")]),o("div",{staticClass:"login-options"},[o("button",{on:{click:e.switchToLogin}},[e._v("\u5207\u6362\u5230\u767B\u5F55")])])]):e._e(),e._m(1)])])},w=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"help-settings"},[e("span",[t._v("\u5E2E\u52A9\u4E0E\u8BBE\u7F6E")])])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"recovery-text"},[t._v("\u624B\u673A\u53F7\u4E0D\u7528\u4E86\uFF1F "),e("a",{attrs:{href:"#"}},[t._v("\u627E\u56DE\u8D26\u53F7")])])}],C=p(h,_,w,!1,null,"9a2bdca0",null,null);const P=C.exports;export{P as default};
