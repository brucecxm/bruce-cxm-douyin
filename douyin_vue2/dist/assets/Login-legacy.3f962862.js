System.register(["./index-legacy.7979773c.js"],(function(e,r){"use strict";var t,o=document.createElement("style");return o.textContent=".disabled .el-upload--picture-card{display:none}.loginContainer{width:350px;margin:100px auto;border-radius:15px;border:1px solid #eaeaea;box-shadow:10px 10px 35px #cac6c6;background:#fff;background-clip:padding-box;padding:25px 35px}.loginTitle{margin:10px auto 30px;text-align:center;color:#505458}.loginRemember{margin:5px auto 35px 80px}\n",document.head.appendChild(o),{setters:[function(e){t=e.n}],execute:function(){var r=function(){var e=this,r=e._self._c;return r("el-container",[r("el-header",[r("el-button",{staticStyle:{float:"right",border:"none"},attrs:{icon:"el-icon-d-arrow-right"},on:{click:e.gotoAdminLogin}},[e._v("管理端登录")])],1),r("el-main",[r("div",{staticClass:"loginContainer"},[r("el-form",{ref:"loginForm",attrs:{rules:e.rules,model:e.loginForm,"label-width":"80px"}},[r("h3",{staticClass:"loginTitle"},[e._v("微言SubtleChat~")]),r("el-form-item",{attrs:{label:"用户名:",prop:"username"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"请输入用户名"},model:{value:e.loginForm.username,callback:function(r){e.$set(e.loginForm,"username",r)},expression:"loginForm.username"}})],1),r("el-form-item",{attrs:{label:"密码:",prop:"password"}},[r("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"请输入密码"},model:{value:e.loginForm.password,callback:function(r){e.$set(e.loginForm,"password",r)},expression:"loginForm.password"}})],1),r("el-form-item",{attrs:{label:"验证码:",prop:"code"}},[r("el-input",{staticStyle:{width:"150px"},attrs:{type:"text","auto-complete":"off",placeholder:"请输入验证码"},nativeOn:{keydown:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.submitLogin.apply(null,arguments)}},model:{value:e.loginForm.code,callback:function(r){e.$set(e.loginForm,"code",r)},expression:"loginForm.code"}}),r("img",{attrs:{src:e.verifyCode,title:"点击切换验证码"},on:{click:e.changeverifyCode}})],1),r("el-checkbox",{staticClass:"loginRemember",model:{value:e.checked,callback:function(r){e.checked=r},expression:"checked"}}),r("span",[e._v(" 记住我一周")]),r("div",[r("el-button",{staticStyle:{width:"45%","margin-right":"15px"},on:{click:e.showRegistryDialog}},[e._v("注册")]),r("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticStyle:{width:"45%"},attrs:{type:"primary"},on:{click:e.submitLogin}},[e._v("登录")])],1)],1)],1)]),r("el-dialog",{attrs:{title:"新用户注册","before-close":e.closeRegisterDialog,visible:e.registerDialogVisible,width:"30%"},on:{"update:visible":function(r){e.registerDialogVisible=r}}},[r("el-form",{ref:"registerForm",attrs:{model:e.registerForm,"status-icon":"",rules:e.registerRules}},[r("el-form-item",{attrs:{label:"用户昵称：","label-width":e.formLabelWidth,prop:"nickname"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:e.registerForm.nickname,callback:function(r){e.$set(e.registerForm,"nickname",r)},expression:" registerForm.nickname"}})],1),r("el-form-item",{attrs:{label:"登录用户名：","label-width":e.formLabelWidth,prop:"username"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:e.registerForm.username,callback:function(r){e.$set(e.registerForm,"username",r)},expression:"registerForm.username"}})],1),r("el-form-item",{attrs:{label:"密码：","label-width":e.formLabelWidth,prop:"password"}},[r("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.registerForm.password,callback:function(r){e.$set(e.registerForm,"password",r)},expression:"registerForm.password"}})],1),r("el-form-item",{attrs:{label:"确认密码：","label-width":e.formLabelWidth,prop:"checkPass"}},[r("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.registerForm.checkPass,callback:function(r){e.$set(e.registerForm,"checkPass",r)},expression:"registerForm.checkPass"}})],1),r("el-form-item",{attrs:{label:"用户头像：","label-width":e.formLabelWidth}},[r("el-upload",{ref:"upload",class:{disabled:e.uploadDisabled},attrs:{action:"/ossFileUpload?module=group-chat","list-type":"picture-card","before-upload":e.beforeAvatarUpload,"file-list":e.fileList,"on-progress":e.onProgress,"on-success":e.imgSuccess,"on-error":e.imgError,"on-remove":e.imgRemove}},[r("i",{staticClass:"el-icon-plus"}),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传不超过4MB的图片(可使用默认头像！)")])])],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(r){return e.submitRegisterForm("registerForm")}}},[e._v("注册")])],1)],1)],1)};e("default",t({name:"Login",data:function(){var e=this;return{loginForm:{username:"",password:"",code:""},verifyCode:"/verifyCode",checked:!0,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},fullscreenLoading:!1,registerDialogVisible:!1,formLabelWidth:"120px",registerForm:{nickname:"",username:"",password:"",checkPass:"",userProfile:"default_head.jpg"},registerRules:{nickname:[{validator:function(r,t,o){""===t&&o(new Error("请输入昵称")),e.getRequest("user/checkNickname?nickname="+t).then((function(e){0!=e?o(new Error("该昵称已被注册")):o()}))},trigger:"blur"}],username:[{validator:function(r,t,o){""===t&&o(new Error("请输入用户名")),e.getRequest("/user/checkUsername?username="+t).then((function(e){0!=e?o(new Error("该用户名已被注册")):o()}))},trigger:"blur"}],password:[{validator:function(r,t,o){""===t?o(new Error("请输入密码")):(""!==e.registerForm.checkPass&&e.$refs.registerForm.validateField("checkPass"),o())},trigger:"blur"}],checkPass:[{validator:function(r,t,o){""===t?o(new Error("请再次输入密码")):t!==e.registerForm.password?o(new Error("两次输入密码不一致!")):o()},trigger:"blur"}]},uploadDisabled:!1,fileList:[]}},methods:{submitLogin:function(){var e=this;this.$refs.loginForm.validate((function(r){if(!r)return e.$message.error("用户名,密码和验证码都不能为空！"),!1;e.fullscreenLoading=!0,e.postKeyValueRequest("/doLogin",e.loginForm).then((function(r){if(setTimeout((function(){e.fullscreenLoading=!1}),1e3),r){e.$store.state.currentUser=r.obj,window.sessionStorage.setItem("user",JSON.stringify(r.obj));var t=e.$route.query.redirect;e.$router.replace("/"==t||null==t?"/chatroom":t)}else e.changeverifyCode()}))}))},changeverifyCode:function(){this.verifyCode="/verifyCode?time="+new Date},gotoAdminLogin:function(){this.$router.replace("/adminlogin")},showRegistryDialog:function(){this.registerDialogVisible=!0},beforeAvatarUpload:function(e){var r=e.size/1024/1024<4;return r||this.$message.error("上传头像图片大小不能超过 4MB!"),r},onProgress:function(e,r,t){this.uploadDisabled=!0},imgSuccess:function(e,r,t){this.uploadDisabled=!0,this.registerForm.userProfile=e,console.log("图片url为："+this.registerForm.userProfile)},imgError:function(e,r,t){this.$message.error("上传失败"),this.uploadDisabled=!1},imgRemove:function(e,r){this.uploadDisabled=!1},closeRegisterDialog:function(e){this.registerForm={nickname:"",username:"",password:"",checkPass:"",userProfile:""},e()},submitRegisterForm:function(e){var r=this;this.$refs[e].validate((function(e){if(!e)return r.$message.error("请正确填写信息！"),console.log("error submit!!"),!1;r.postRequest("/user/register",r.registerForm).then((function(e){e&&(r.registerDialogVisible=!1,location.reload())}))}))}}},r,[],!1,null,null,null,null).exports)}}}));
