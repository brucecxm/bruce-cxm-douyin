# bruce-douyin(仿抖音短视频)



### 项目概述


 本项目为一款仿抖音的短视频社交平台，用户可上传、浏览、点赞、评论短视频，并支持音乐添加、商品购买等功能。平台融合了内容推荐、社交互动、电商变现等模块，构建完整的短视频生态体系，前后端分离开发，支持移动端和管理后台系统。

核心功能：

- 用户注册登录（含第三方授权）
- 视频上传、播放、点赞、评论、收藏
- 音乐库管理与音视频合成
- 好友关注与私信聊天
- 短视频推荐（基于用户行为的算法）
- 商品展示与下单支付
- 后台运营管理系统（用户、内容、商品、订单等）

### 业务说明

![image-20210407204405774](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210407204405774.png)

项目演示地址：

- 平台管理：[http://heima-admin-java.research.itcast.cn](http://heima-admin-java.research.itcast.cn/) 

- 自媒体：[http://heime-media-java.research.itcast.cn](http://heime-media-java.research.itcast.cn/) 

- app端：[http://heima-app-java.research.itcast.cn](http://heima-app-java.research.itcast.cn/) 

- 

技术栈

![img](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/f3accd2ba01c41b0a9ac98370241eba3.png)

- Spring-Cloud-Gateway : 微服务之前架设的网关服务，实现服务注册中的API请求路由，以及控制流速控制和熔断处理都是常用的架构手段，而这些功能Gateway天然支持
- 运用Spring Boot快速开发框架，构建项目工程；并结合Spring Cloud全家桶技术，实现后端个人中心、自媒体、管理中心等微服务。
- 运用Spring Cloud Alibaba Nacos作为项目中的注册中心和配置中心
- 运用mybatis-plus作为持久层提升开发效率
- 运用Kafka完成内部系统消息通知；与客户端系统消息通知；以及实时数据计算
- 运用Redis缓存技术，实现热数据的计算，提升系统性能指标
- 使用Mysql存储用户数据，以保证上层数据查询的高性能
- 使用Mongo存储用户热数据，以保证用户热数据高扩展和高性能指标
- 使用FastDFS作为静态资源存储器，在其上实现热静态资源缓存、淘汰等功能
- 运用Hbase技术，存储系统中的冷数据，保证系统数据的可靠性
- 运用ES搜索技术，对冷数据、文章数据建立索引，以保证冷数据、文章查询性能
- 运用AI技术，来完成系统自动化功能，以提升效率及节省成本。比如实名认证自动化
- PMD&P3C : 静态代码扫描工具，在项目中扫描项目代码，检查异常点、优化点、代码规范等，为开发团队提供规范统一，提升项目代码质量





## 初始工程搭建

### 环境准备

①：项目依赖环境

- JDK1.8

- Intellij Idea

- maven-3.6.1

- Git





### 主体结构

![image-20210412141711919](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210412141711919.png)



## 登录

### 需求分析

![image-20210412141809919](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210412141809919.png)

- 用户点击**开始使用**

  登录后的用户权限较大，可以查看，也可以操作（点赞，关注，评论）

- 用户点击**不登录，先看看**

​       游客只有查看的权限

### 表结构分析

关于app端用户相关的内容较多，可以单独设置一个库leadnews_user

| **表名称**       | **说明**          |
| ---------------- | ----------------- |
| ap_user          | APP用户信息表     |
| ap_user_fan      | APP用户粉丝信息表 |
| ap_user_follow   | APP用户关注信息表 |
| ap_user_realname | APP实名认证信息表 |

从当前资料中找到对应数据库并导入到mysql中



登录需要用到的是ap_user表，表结构如下：

![image-20210412142006558](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210412142006558.png)

![image-20210412142055047](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210412142055047.png)

项目中的持久层使用的mybatis-plus，一般都使用mybais-plus逆向生成对应的实体类

手动加密（md5+随机字符串）

md5是不可逆加密，md5相同的密码每次加密都一样，不太安全。在md5的基础上手动加盐（salt）处理

注册->生成盐

![image-20210412142315248](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210412142315248.png)

登录->使用盐来配合验证

![image-20210412142428499](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210412142428499.png)



### 思路分析

![image-20210412142536782](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210412142536782.png)

1，用户输入了用户名和密码进行登录，校验成功后返回jwt(基于当前用户的id生成)

2，用户游客登录，生成jwt返回(基于默认值0生成)‘



### 全局过滤器实现jwt校验

![image-20210705110434492](D:/专业/项目/黑马头条项目/day1/讲义/01-环境搭建、SpringCloud微服务(注册发现、服务调用、网关).assets/image-20210705110434492.png)

思路分析：

1. 用户进入网关开始登陆，网关过滤器进行判断，如果是登录，则路由到后台管理微服务进行登录
2. 用户登录成功，后台管理微服务签发JWT TOKEN信息返回给用户
3. 用户再次进入网关开始访问，网关过滤器接收用户携带的TOKEN 
4. 网关过滤器解析TOKEN ，判断是否有权限，如果有，则放行，如果没有则返回未认证错误










